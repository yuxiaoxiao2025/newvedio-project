---
title: 前缀续写
update: 2025-11-10
source: https://help.aliyun.com/zh/model-studio/partial-mode
---

在代码补全、文本续写等场景中，需要模型从已有的文本片段（前缀）继续生成。Partial Mode 通过在最后一条 `assistant` 消息设置 `partial: true`，以该前缀为起点生成结果。

## 使用方式

- 在 `messages` 中最后一条消息使用 `role: assistant`，并携带前缀内容
- 在该消息上设置 `partial: true`

## 快速开始（代码补全示例）

```python
import os
from openai import OpenAI

client = OpenAI(
    api_key=os.getenv("DASHSCOPE_API_KEY"),
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)

prefix = """def calculate_fibonacci(n):
    if n <= 1:
        return n
    else:
"""

completion = client.chat.completions.create(
    model="qwen3-coder-plus",
    messages=[
        {"role": "user", "content": "请补全这个斐波那契函数，勿添加其它内容"},
        {"role": "assistant", "content": prefix, "partial": True},
    ],
)

generated_code = completion.choices[0].message.content
print(prefix + generated_code)
```

```javascript
import OpenAI from "openai";

const openai = new OpenAI({
    apiKey: process.env.DASHSCOPE_API_KEY,
    baseURL: "https://dashscope.aliyuncs.com/compatible-mode/v1"
});

const prefix = `def calculate_fibonacci(n):
    if n <= 1:
        return n
    else:
`;

const completion = await openai.chat.completions.create({
    model: "qwen3-coder-plus",
    messages: [
        { role: "user", content: "请补全这个斐波那契函数，勿添加其它内容" },
        { role: "assistant", content: prefix, partial: true }
    ],
});

console.log(prefix + completion.choices[0].message.content);
```

## 多模态前缀续写

```python
import os
from openai import OpenAI

client = OpenAI(
    api_key=os.getenv("DASHSCOPE_API_KEY"),
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)

completion = client.chat.completions.create(
    model="qwen3-vl-plus",
    messages=[
        {
            "role": "user",
            "content": [
                {"type": "image_url", "image_url": {"url": "https://img.alicdn.com/imgextra/i3/O1CN01zFX2Bs1Q0f9pESgPC_!!6000000001914-2-tps-450-450.png"}},
                {"type": "text", "text": "我要发社交媒体，请帮我想一下文案。"}
            ],
        },
        { "role": "assistant", "content": "今天发现了一家宝藏咖啡馆", "partial": True },
    ],
)
print(completion.choices[0].message.content)
```

```javascript
import OpenAI from "openai";

const openai = new OpenAI({
    apiKey: process.env.DASHSCOPE_API_KEY,
    baseURL: "https://dashscope.aliyuncs.com/compatible-mode/v1"
});

const response = await openai.chat.completions.create({
    model: "qwen3-vl-plus",
    messages: [
        {
            role: "user",
            content: [
                { type: "image_url", image_url: { url: "https://img.alicdn.com/imgextra/i3/O1CN01zFX2Bs1Q0f9pESgPC_!!6000000001914-2-tps-450-450.png" } },
                { type: "text", text: "我要发社交媒体，请帮我想一下文案。" }
            ]
        },
        { role: "assistant", content: "今天发现了一家宝藏咖啡馆", partial: true }
    ]
});
console.log(response.choices[0].message.content);
```

## 基于不完整输出进行续写

若因 `max_tokens` 或超时导致输出不完整，可将不完整输出作为前缀进行续写：

```python
import os
from openai import OpenAI

client = OpenAI(
    api_key=os.getenv("DASHSCOPE_API_KEY"),
    base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
)

def chat_completion(messages, max_tokens=None):
    response = client.chat.completions.create(
        model="qwen-plus",
        messages=messages,
        max_tokens=max_tokens
    )
    return response.choices[0].message.content

messages = [{"role": "user", "content": "请写一个短篇科幻故事"}]
first_content = chat_completion(messages, max_tokens=40)
messages.append({"role": "assistant", "content": first_content, "partial": True})
second_content = chat_completion(messages)
print(first_content + second_content)
```

```javascript
import OpenAI from "openai";

const openai = new OpenAI({
    apiKey: process.env.DASHSCOPE_API_KEY,
    baseURL: "https://dashscope.aliyuncs.com/compatible-mode/v1"
});

async function chatCompletion(messages, maxTokens = null) {
    const completion = await openai.chat.completions.create({
        model: "qwen-plus",
        messages,
        max_tokens: maxTokens
    });
    return completion.choices[0].message.content;
}

let messages = [{ role: "user", content: "请写一个短篇科幻故事" }];
const firstContent = await chatCompletion(messages, 40);
messages.push({ role: "assistant", content: firstContent, partial: true });
const secondContent = await chatCompletion(messages);
console.log(firstContent + secondContent);
```